<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Incremental</title>
    <script type="text/javascript" src="script.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>

    <style>
        .content {
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
        }

        .Mejoras {
            height: 80px;
            width: 100%;
            border: 2px solid blue;
            margin-bottom: 2px;
            margin-left: 10px;
            background-color: #3a3afd;
            color: #5dedfb;
            font-family: monospace;
        }

        p {
            margin-bottom: 0px !important;
            margin-left: 10px;
        }

        .Cuadrado {
            width: 80%;
            aspect-ratio: 1;
            margin-left: 10%;
            border: 2px solid blue;
            background-color: #3a3afd;
        }

        .Pixel {
            /*border: 1px solid black;*/
            background-color: #031683;
            width: 5%;
            aspect-ratio: 1;
            display: inline-block;
            overflow: auto;
            color: #5dedfb;
        }

        .Ticado {
            /*border: 1px solid black;*/
            width: 5%;
            aspect-ratio: 1;
            display: inline-block;
            background-color: #3f2dff;
            overflow: auto;
            color: #5dedfb;
        }

        .Disabled {
            pointer-events: none;
            opacity: 0.5;
        }
    </style>

    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card" style="margin-top: 1.5vh;">
                        <div class="card-header text-center">
                            <h3>Pruebas</h3>
                            <p>Tienes <span id="Pixeles">0</span> pixeles.</p>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-1"></div>
                                <div class="col-3">
                                    <div class="Mejoras" onclick="ActiveDmg()">
                                        <div class="row">
                                            <div class="col-8">
                                                <p class="Titulo">Active Dmg</p>
                                                <p class="Incremento">+1 active Dmg</p>
                                                <p class="Total">Each click deals <span id="Dano">1</span></p>
                                            </div>
                                            <div class="col-4 text-center">
                                                <p>------------</p>
                                                <p><span id="Dano_Cost">12</span> pix</p>
                                                <p>------------</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="Mejoras Disabled" onclick="ActiveMultiClick()">
                                        <div class="row">
                                            <div class="col-8">
                                                <p class="Titulo">Active Multiclick</p>
                                                <p class="Incremento">+1 block Dmg</p>
                                                <p class="Total"><span id="ExtraHits">0</span> blocks hit extra</p>
                                            </div>
                                            <div class="col-4 text-center">
                                                <p>------------</p>
                                                <p><span id="ExtraHits_Cost">100</span> pix</p>
                                                <p>------------</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4 text-center">
                                    <div class="Cuadrado" property="289" title="1">
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                        <div class="Pixel"></div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="Mejoras" onclick="IdleHitters()">
                                        <div class="row">
                                            <div class="col-8">
                                                <p class="Titulo">Idle Hitters</p>
                                                <p class="Incremento">+1 idle hitter</p>
                                                <p class="Total">You have <span id="IdleHitters">1</span> idle hitters</p>
                                            </div>
                                            <div class="col-4 text-center">
                                                <p>------------</p>
                                                <p><span id="IdleHitters_Cost">20</span> pix</p>
                                                <p>------------</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="Mejoras" onclick="IdleHittersDmg()">
                                        <div class="row">
                                            <div class="col-8">
                                                <p class="Titulo">Idle Hitters Dmg</p>
                                                <p class="Incremento">+1 idle Dmg</p>
                                                <p class="Total"><span id="IdleDmg">1</span> per idle hit</p>
                                            </div>
                                            <div class="col-4 text-center">
                                                <p>------------</p>
                                                <p><span id="IdleDmg_Cost">30</span> pix</p>
                                                <p>------------</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="Mejoras" onclick="IdleHittersCrit()">
                                        <div class="row">
                                            <div class="col-8">
                                                <p class="Titulo">Idle Hitter Crit.</p>
                                                <p class="Incremento">+1% crit. prob</p>
                                                <p class="Total"><span id="IdleCritHit">0</span>% for 2x idle dmg</p>
                                            </div>
                                            <div class="col-4 text-center">
                                                <p>------------</p>
                                                <p><span id="IdleCritHit_Cost">50</span> pix</p>
                                                <p>------------</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-1"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script type="text/javascript">
        //Start
        $(function () {
            var PixelesInicio = getCookie("Pixeles");
            if (PixelesInicio != null && PixelesInicio != '' && PixelesInicio != 'NaN') {
                RecuperarGuardado();
            }

            $('.Pixel').text($(".Cuadrado").attr("title"));

            $('.Pixel').on('click', function (e) {
                Pixel(this)
            });

            var Interval = setInterval(function () {
                var IdleHitters = parseInt($("#IdleHitters").text());
                for (var i = 0; i < IdleHitters; i += 1) {
                    var randomIndex = Math.floor(Math.random() * $('.Pixel').length);
                    var dmg = parseInt($("#IdleDmg").text());

                    var Perc = $("#IdleCritHit").text();

                    if (Perc.length == 1) {
                        Perc = "0.0" + Perc
                    } else if (Perc.length == 2) {
                        Perc = "0." + Perc
                    } else if (Perc.length == 3) {
                        Perc = Perc
                    }

                    if (Math.random() < Perc) {
                        dmg = dmg * 2;
                    }

                    Pixel($('.Pixel')[randomIndex], dmg);
                }
            }, 5000);

            var AutoGuardado = setInterval(function () {
                Guardado();
            }, 10000);
        });


        //Click Function
        function Pixel(px, dmg) {
            if (dmg == null) {
                dmg = parseInt($("#Dano").text());
            }

            var ActualHealth = parseInt($(px).text());
            var Health = ActualHealth - dmg;

            if (Health <= 0) {
                $(px).addClass('Ticado');
                $(px).removeClass('Pixel');
                $(px).off('click');
                $(px).text("");

                $("#Pixeles").text(parseInt($("#Pixeles").text()) + 1)

                $('.Cuadrado').attr('property', parseInt($('.Cuadrado').attr('property')) - 1)

                if ($('.Cuadrado').attr('property') == "0") {
                    $('.Ticado').addClass('Pixel');
                    $('.Ticado').removeClass('Ticado');
                    $('.Cuadrado').attr('property', 289);
                    $('.Pixel').on('click', function (e) {
                        Pixel(this)
                    });

                    $(".Cuadrado").attr("title", parseInt($(".Cuadrado").attr("title")) + 1)
                    $('.Pixel').text($(".Cuadrado").attr("title"));

                    Guardado()
                }
            } else {
                $(px).text(Health);
            }
        }



        //Click
        function ActiveDmg() {
            if (parseInt($("#Pixeles").text()) >= parseInt($("#Dano_Cost").text())) {
                DescontarPixeles(parseInt($("#Dano_Cost").text()));
                $("#Dano").text(parseInt($("#Dano").text()) + 1)
                ActualizarPrecio("Dano_Cost");
            }
        }
        function ActiveMultiClick() {
            if (parseInt($("#Pixeles").text()) >= parseInt($("#ExtraHits_Cost").text())) {
                DescontarPixeles(parseInt($("#ExtraHits_Cost").text()));
                $("#ExtraHits").text(parseInt($("#ExtraHits").text()) + 1)
                ActualizarPrecio("ExtraHits_Cost");
            }
        }



        //Hitters
        function IdleHitters() {
            if (parseInt($("#Pixeles").text()) >= parseInt($("#IdleHitters_Cost").text())) {
                DescontarPixeles(parseInt($("#IdleHitters_Cost").text()));
                $("#IdleHitters").text(parseInt($("#IdleHitters").text()) + 1)
                ActualizarPrecio("IdleHitters_Cost");
            }
        }
        function IdleHittersDmg() {
            if (parseInt($("#Pixeles").text()) >= parseInt($("#IdleDmg_Cost").text())) {
                DescontarPixeles(parseInt($("#IdleDmg_Cost").text()));
                $("#IdleDmg").text(parseInt($("#IdleDmg").text()) + 1)
                ActualizarPrecio("IdleDmg_Cost");
            }
        }
        function IdleHittersCrit() {
            if (parseInt($("#Pixeles").text()) >= parseInt($("#IdleCritHit_Cost").text())) {
                DescontarPixeles(parseInt($("#IdleCritHit_Cost").text()));
                $("#IdleCritHit").text(parseInt($("#IdleCritHit").text()) + 1)
                ActualizarPrecio("IdleCritHit_Cost");
            }
        }

        //Funcionalidades

        function DescontarPixeles(value) {
            $("#Pixeles").text(parseInt($("#Pixeles").text()) - value)
        }

        function ActualizarPrecio(id) {
            $("#" + id).text(Math.round(parseInt($("#" + id).text()) * 1.12));
        }

        function setCookie(cname, cvalue, exdays) {
            const d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            let expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/;domain=" + window.location.hostname;
        }

        function getCookie(cname) {
            let name = cname + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function Guardado() {
            var Pixeles = $("#Pixeles").text();
            setCookie("Pixeles", Pixeles, 365);
            var Cuadrado_Title = $(".Cuadrado").attr("title");
            setCookie("Cuadrado_Title", Cuadrado_Title, 365);

            var Dano = $("#Dano").text();
            setCookie("Dano", Dano, 365);
            var Dano_Cost = $("#Dano_Cost").text();
            setCookie("Dano_Cost", Dano_Cost, 365);

            var IdleHitters = $("#IdleHitters").text();
            setCookie("IdleHitters", IdleHitters, 365);
            var IdleHitters_Cost = $("#IdleHitters_Cost").text();
            setCookie("IdleHitters_Cost", IdleHitters_Cost, 365);

            var IdleDmg = $("#IdleDmg").text();
            setCookie("IdleDmg", IdleDmg, 365);
            var IdleDmg_Cost = $("#IdleDmg_Cost").text();
            setCookie("IdleDmg_Cost", IdleDmg_Cost, 365);

            var IdleCritHit = $("#IdleCritHit").text();
            setCookie("IdleCritHit", IdleCritHit, 365);
            var IdleCritHit_Cost = $("#IdleCritHit_Cost").text();
            setCookie("IdleCritHit_Cost", IdleCritHit_Cost, 365);

            console.log("Guardado Automatico");
        }

        function RecuperarGuardado() {
            var Pixeles = getCookie("Pixeles");
            if (Pixeles != null && Pixeles != '' && Pixeles != 'NaN') {
                $("#Pixeles").text(Pixeles);
            }

            $(".Cuadrado").attr("title", getCookie("Cuadrado_Title"));

            $("#Dano").text(getCookie("Dano"));
            $("#Dano_Cost").text(getCookie("Dano_Cost"));

            $("#IdleHitters").text(getCookie("IdleHitters"));
            $("#IdleHitters_Cost").text(getCookie("IdleHitters_Cost"));

            $("#IdleDmg").text(getCookie("IdleDmg"));
            $("#IdleDmg_Cost").text(getCookie("IdleDmg_Cost"));

            $("#IdleCritHit").text(getCookie("IdleCritHit"));
            $("#IdleCritHit_Cost").text(getCookie("IdleCritHit_Cost"));
        }
    </script>

</body>
</html>